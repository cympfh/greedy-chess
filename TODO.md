# TODO.md

## 🔴 Critical Missing Features

### Core AI Algorithm
- [ ] **Min-Max探索アルゴリズム実装**: READMEで説明されているmin-maxアルゴリズムが未実装
- [ ] **コマンドライン引数処理**: 探索深度nをコマンドライン引数から受け取る機能
- [ ] **評価関数実装**: 駒の価値に基づく局面評価関数
- [ ] **次の一手生成**: 現在のmain関数は盤面表示のみで、AIの指し手を出力していない

### Legal Move Generation
- [ ] **合法手生成**: 現在は移動可能性チェックのみで、実際の合法手生成が未実装
- [ ] **チェック判定**: キングが攻撃されているかの判定
- [ ] **チェックメイト/ステイルメイト判定**: ゲーム終了条件の検出
- [ ] **ピン/スキュワー処理**: 駒が動けない状況の正確な判定

## 🟡 重要な改善項目

### Chess Rules Compliance
- [ ] **三回同型局面**: 同じ局面が3回現れた場合の引き分け判定
- [ ] **50手ルール**: 駒取りやポーン移動がない状態での引き分け判定
- [ ] **不十分な駒による引き分け**: K vs K, KB vs K等の判定

### Move Validation Enhancement
- [ ] **キャスリング条件**: より厳密なキャスリング可能性チェック
  - [ ] キングが一度も動いていない
  - [ ] ルークが一度も動いていない
  - [ ] キングとルークの間が空いている
  - [ ] キングが攻撃されていない
  - [ ] 通過地点が攻撃されていない
  - [ ] 到着地点が攻撃されていない
- [ ] **アンパッサン条件**: より厳密なen passant判定

### Algorithm Improvements
- [ ] **アルファベータ剪定**: Min-maxの高速化
- [ ] **移動順序付け**: より効率的な探索のための手の順序付け
- [ ] **置換表**: 既に評価した局面のキャッシュ
- [ ] **反復深化**: 時間制限内での最適解探索

## 🟢 Enhancement Features

### User Interface
- [ ] **SAN出力**: 出力もSAN形式に対応
- [ ] **PGN対応**: 完全なPGNファイル読み込み/出力
- [ ] **FEN対応**: FEN記法での局面入出力
- [ ] **対話モード**: 継続的に手を入力して対戦できるモード

### Performance & Quality
- [ ] **並列探索**: マルチスレッドでの探索高速化
- [ ] **開始局面データベース**: オープニングブック
- [ ] **終盤データベース**: エンドゲームテーブルベース
- [ ] **局面評価の改善**: ポジション要素を考慮した評価関数

### Code Quality
- [ ] **未使用コード削除**:
  - [ ] `std::collections::HashSet`の削除
  - [ ] `is_own`メソッドの削除または使用
  - [ ] `kind_from_char`関数の削除または使用
- [ ] **エラー処理改善**: より詳細で親切なエラーメッセージ
- [ ] **テスト追加**: ユニットテストとインテグレーションテスト
- [ ] **ドキュメント**: 関数とモジュールのドキュメント化

### Configuration
- [ ] **設定ファイル**: 評価パラメータの外部設定
- [ ] **ログ機能**: 探索過程の詳細ログ出力
- [ ] **デバッグモード**: 探索ツリーの可視化

## 🔧 Technical Debt

### Code Organization
- [ ] **モジュール分割**: 大きなmain.rsを機能別モジュールに分割
- [ ] **型安全性**: newtype patternによる座標系の型安全化
- [ ] **エラー型**: カスタムエラー型の定義

### Performance
- [ ] **メモリ最適化**: 不要なクローンの削減
- [ ] **コンパイル最適化**: Release buildでの最適化設定
- [ ] **ベンチマーク**: パフォーマンス測定とプロファイリング

## Priority Order

1. **High Priority**: Core AI Algorithm, Legal Move Generation
2. **Medium Priority**: Chess Rules Compliance, Algorithm Improvements
3. **Low Priority**: Enhancement Features, Code Quality improvements

## Notes

- 現在の実装は盤面管理と移動パーサーは良く出来ているが、肝心のAIアルゴリズムが未実装
- READMEの使用例 `Re1` を出力するには、まずmin-maxアルゴリズムの実装が必要
- 段階的な実装: まず基本的な合法手生成から始めて、評価関数、min-max探索の順で実装することを推奨